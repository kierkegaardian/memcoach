<li id="card-{{ card.id }}" class="py-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div class="space-y-1">
        <p class="font-medium text-gray-800">{{ card.prompt }}</p>
        {% if kid_id %}
            <p class="text-sm text-gray-500">Streak: {{ card.streak }} | Due: {{ card.due_date }}</p>
        {% else %}
            <p class="text-sm text-gray-500">Select a kid to view progress.</p>
        {% endif %}
        {% if card.tags %}
            <div class="flex flex-wrap gap-2">
                {% for tag in card.tags %}
                    <span class="text-xs font-semibold uppercase tracking-wide px-2 py-1 rounded bg-slate-100 text-slate-700">{{ tag }}</span>
                {% endfor %}
            </div>
        {% endif %}
        <form
            class="flex flex-wrap gap-2 text-xs"
            hx-post="/decks/{{ deck_id }}/cards/{{ card.id }}/tags"
            hx-target="#card-{{ card.id }}"
            hx-swap="outerHTML"
        >
            {% if kid_id %}
                <input type="hidden" name="kid_id" value="{{ kid_id }}">
            {% endif %}
            <label for="card-tags-{{ card.id }}" class="sr-only">Tags</label>
            <input
                id="card-tags-{{ card.id }}"
                name="tags"
                type="text"
                value="{{ card.tags | join(', ') }}"
                placeholder="tag1, tag2"
                class="border border-gray-300 rounded px-2 py-1 text-xs w-48"
            >
            <button type="submit" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600">Save tags</button>
        </form>
    </div>
    <div class="flex flex-wrap items-center gap-2">
        {% if kid_id %}
            <span class="text-xs font-semibold uppercase tracking-wide px-2 py-1 rounded
                {% if card.mastery_status == 'mastered' %}
                    bg-green-100 text-green-800
                {% elif card.mastery_status == 'learning' %}
                    bg-yellow-100 text-yellow-800
                {% else %}
                    bg-gray-100 text-gray-700
                {% endif %}
            ">
                {{ card.mastery_status }}
            </span>
        {% endif %}
        <div class="flex flex-wrap gap-2">
            <button
                class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs hover:bg-gray-300 disabled:opacity-50"
                hx-post="/decks/{{ deck_id }}/cards/{{ card.id }}/move"
                {% if kid_id %}
                    hx-vals='{"direction": "up", "kid_id": "{{ kid_id }}"}'
                {% else %}
                    hx-vals='{"direction": "up"}'
                {% endif %}
                hx-target="#card-list"
                hx-swap="innerHTML"
                {% if is_first %}disabled{% endif %}
            >
                ↑
            </button>
            <button
                class="bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs hover:bg-gray-300 disabled:opacity-50"
                hx-post="/decks/{{ deck_id }}/cards/{{ card.id }}/move"
                {% if kid_id %}
                    hx-vals='{"direction": "down", "kid_id": "{{ kid_id }}"}'
                {% else %}
                    hx-vals='{"direction": "down"}'
                {% endif %}
                hx-target="#card-list"
                hx-swap="innerHTML"
                {% if is_last %}disabled{% endif %}
            >
                ↓
            </button>
            <button
                class="bg-yellow-500 text-white px-2 py-1 rounded text-xs hover:bg-yellow-600"
                hx-get="/decks/{{ deck_id }}/cards/{{ card.id }}/edit{% if kid_id %}?kid_id={{ kid_id }}{% endif %}"
                hx-target="#card-{{ card.id }}"
                hx-swap="outerHTML"
            >
                Edit
            </button>
            <button
                class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600"
                hx-post="/decks/{{ deck_id }}/cards/{{ card.id }}/delete"
                hx-target="#card-{{ card.id }}"
                hx-swap="outerHTML"
            >
                Delete
            </button>
        </div>
    </div>
</li>
